/*! Skyrim-Mod-Watcher 17-01-2015 */
var mongoose=require("mongoose"),bcrypt=require("bcrypt-nodejs"),Schema=mongoose.Schema,modlistSchema=new Schema({list:String,modlisttxt:String,skyrimini:String,skyrimprefsini:String,username:String,password:String,plugins:[],modlist:[],ini:[],prefsini:[],tag:String,enb:String,game:String,pic:String,timestamp:Date},{collection:"modlist"}),modlistSchemas=mongoose.model("modlist",modlistSchema);modlistSchema.methods.generateHash=function(a){return bcrypt.hashSync(a,bcrypt.genSaltSync(8),null)},modlistSchema.methods.validPassword=function(a){return bcrypt.compareSync(a,this.password)},modlistSchema.methods.UpdateOldStyleModlist=function(){var a=[],b=[];if(save=!1,"[]"!=this.list||this.plugins.length>0&&"[]"==this.list){a=this.list.split('","'),a[0]=a[0].substring(2),a[a.length-1]=a[a.length-1].substring(0,a[a.length-1].length-2),b=[];for(var c=0;c<a.length;c++)b[c]={name:a[c]};this.plugins=b,this.list="",save=!0}if("[]"!=this.modlisttxt||this.modlist.length>0&&"[]"==this.modlisttxt){if(void 0==this.modlisttxt)this.modlist=[];else{a=this.modlisttxt.split('","'),a[0]=a[0].substring(2),a[a.length-1]=a[a.length-1].substring(0,a[a.length-1].length-2),b=[];for(var c=0;c<a.length;c++)b[c]={name:a[c]};this.modlist=""==b[0].name?[]:b,this.modlisttxt=""}save=!0}if("[]"!=this.skyrimini||this.ini.length>0&&"[]"==this.ini){if(void 0==this.skyrimini)this.ini=[];else{a=this.skyrimini.split('","'),a[0]=a[0].substring(2),a[a.length-1]=a[a.length-1].substring(0,a[a.length-1].length-2),b=[];for(var c=0;c<a.length;c++)b[c]={name:a[c]};this.ini=""==b[0].name?[]:b,this.skyrimini=""}save=!0}if("[]"!=this.skyrimprefsini||this.prefsini.length>0&&"[]"==this.prefsini){if(void 0==this.skyrimprefsini)this.prefsini=[];else{a=this.skyrimprefsini.split('","'),a[0]=a[0].substring(2),a[a.length-1]=a[a.length-1].substring(0,a[a.length-1].length-2),b=[];for(var c=0;c<a.length;c++)b[c]={name:a[c]};this.prefsini=""==b[0].name?[]:b,this.skyrimprefsini=""}save=!0}null==this.timestamp&&(this.timestamp=new Date("7/10/2014"),save=!0),null==this.game&&(this.game="skyrim",save=!0),save&&this.save()},modlistSchema.methods.GetGPU=function(){this.plugins.length<1&&this.UpdateOldStyleModlist();for(var a=0;a<this.prefsini.length;a++)if(this.prefsini[a].name.indexOf("sD3DDevice")>=0)return gpu=this.prefsini[a].name.split("=")[1].trim(),gpu.indexOf(";")>=0||gpu.indexOf("//")>=0?0:gpu.substr(1,gpu.length-2).trim();return 0},module.exports=mongoose.model("Modlist",modlistSchema);