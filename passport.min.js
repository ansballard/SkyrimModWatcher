/*! Skyrim-Mod-Watcher 21-01-2015 */
var LocalStrategy=require("passport-local").Strategy,Admin=require("./models/admin.min.js"),Modlist=require("./models/modlist.min.js");module.exports=function(a){a.serializeUser(function(a,b){b(null,a.id)}),a.deserializeUser(function(a,b){Modlist.findById(a,function(a,c){b(a,c)})}),a.use("register",new LocalStrategy({usernameField:"username",passwordField:"password",passReqToCallback:!0},function(a,b,c,d){process.nextTick(function(){Modlist.findOne({username:b},function(a,e){if(a)return d(a);if(e)return d(null,!1,console.log("username already taken"));var e=new Modlist;e.username=b,e.password=e.generateHash(c),e.save(function(a){if(a)throw a;return d(null,e)})})})})),a.use("login",new LocalStrategy({usernameField:"username",passwordField:"password",passReqToCallback:!0},function(a,b,c,d){Modlist.findOne({username:b},function(a,b){return a?d(a):b?b.validPassword(c)?d(null,b):d(null,!1,console.log("Wrong Password")):d(null,!1,console.log("username doesn't exist"))})}))};